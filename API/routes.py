from API import app

from schema import *
from model import *
import json
from fastapi import Body, FastAPI, File, UploadFile
from typing import Union
from pprint import pprint
import multiline

example_input = """Enter your stackoverflow question here"""
@app.post("/vulnerabilities")
def vulns(file: Union[UploadFile, None] = None ) -> Vuln_response:
    if not file:
        code = None
        return {"message": "No upload file sent"}
    else:
        code = "\n".join(file.file.read().decode("utf-8").split("\n"))
        return find_vulns("", code)



@app.post("/tags")
def tags(question: str = Body(example_input, media_type='text/plain')) -> Tags_response:
    return find_tags(question, "")


@app.post("/app")
def main(question: str = Body(example_input, media_type='text/plain'), file: Union[UploadFile, None] = None ) -> Response:
    if not file:
        code = None
        return {"message": "No upload file sent"}
    else:
        code = "\n".join(file.file.read().decode("utf-8").split("\n"))
        return call(question, code)